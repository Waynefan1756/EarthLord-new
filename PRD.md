# 产品需求文档 (PRD)
## 《地球新主》- EarthLord

---

## 一、产品概述

### 1.1 产品定位
《地球新主》是一款基于地理位置的AR互动游戏，玩家通过圈地、交易、建设等方式在现实世界中争夺领地，成为区域的"新主"。

### 1.2 目标用户
- **核心用户**：18-35岁，喜欢探索户外、社交互动的年轻用户
- **次要用户**：地理位置游戏爱好者、AR技术尝鲜者

### 1.3 产品目标
- 用户留存率：首月留存率达到40%
- 日活跃用户：上线3个月内达到10万DAU
- 用户参与度：平均每日游戏时长30分钟以上

---

## 二、核心功能模块

### 2.1 登录与认证系统

#### 功能描述
提供安全便捷的用户登录和身份认证功能。

#### 功能需求
- **FR-AUTH-001**: 支持手机号+验证码登录
- **FR-AUTH-002**: 支持第三方登录（微信、Apple ID）
- **FR-AUTH-003**: 用户首次登录需完成基础信息填写（昵称、头像）
- **FR-AUTH-004**: 支持自动登录和登出功能
- **FR-AUTH-005**: 实现Token刷新机制，保证会话安全

#### 交互流程
1. 用户打开App进入启动页
2. 未登录用户跳转至登录页
3. 用户选择登录方式
4. 完成认证后进入主界面
5. 已登录用户直接进入主界面

#### 非功能需求
- 登录响应时间 < 2秒
- Token有效期7天
- 支持离线状态下的本地缓存

---

### 2.2 圈地系统

#### 功能描述
玩家可以在真实地理位置上圈占领地，成为该区域的所有者。

#### 功能需求
- **FR-LAND-001**: 基于GPS定位获取用户当前位置
- **FR-LAND-002**: 在地图上显示可圈占的区域
- **FR-LAND-003**: 用户可以选择圆形区域进行圈地（半径可调）
- **FR-LAND-004**: 圈地需消耗游戏货币或道具
- **FR-LAND-005**: 显示领地信息（所有者、价值、收益等）
- **FR-LAND-006**: 支持领地升级和扩张
- **FR-LAND-007**: 防止重复圈地，已被占领的区域需通过交易或挑战获得

#### 交互流程
1. 用户进入地图页面
2. 定位到当前位置
3. 点击"圈地"按钮
4. 调整圈地范围
5. 确认并支付费用
6. 完成圈地，领地归属用户

#### 非功能需求
- 定位精度 < 10米
- 地图加载时间 < 3秒
- 支持离线地图缓存

---

### 2.3 地图首页

#### 功能描述
展示游戏世界地图，显示玩家领地、其他玩家领地、可占领区域等信息。

#### 功能需求
- **FR-MAP-001**: 集成地图SDK（高德/百度地图）
- **FR-MAP-002**: 实时显示用户位置
- **FR-MAP-003**: 用不同颜色标识不同状态的领地
  - 自己的领地：绿色
  - 其他玩家领地：红色
  - 可占领区域：灰色
- **FR-MAP-004**: 支持地图缩放和拖拽
- **FR-MAP-005**: 点击领地显示详细信息卡片
- **FR-MAP-006**: 显示附近的重要地标和建筑
- **FR-MAP-007**: 提供搜索功能，查找特定位置

#### 交互流程
1. 用户登录后进入地图首页
2. 地图自动定位到用户当前位置
3. 用户可浏览周围领地情况
4. 点击任意领地查看详情
5. 通过底部导航切换到其他功能模块

---

### 2.4 AR扫描功能

#### 功能描述
通过AR技术扫描现实场景，发现隐藏资源、完成任务或解锁特殊功能。

#### 功能需求
- **FR-AR-001**: 集成ARKit框架
- **FR-AR-002**: 支持摄像头权限申请和管理
- **FR-AR-003**: 识别平面和空间锚点
- **FR-AR-004**: 在AR视图中显示虚拟物体（宝箱、道具等）
- **FR-AR-005**: 用户点击虚拟物体进行交互
- **FR-AR-006**: 记录AR扫描历史和获得的奖励
- **FR-AR-007**: 提供AR教学引导

#### 交互流程
1. 用户点击"AR扫描"按钮
2. 请求摄像头权限
3. 进入AR扫描模式
4. 移动设备扫描周围环境
5. 发现虚拟物体时显示提示
6. 点击收集或交互
7. 返回地图页面

#### 非功能需求
- AR识别响应时间 < 1秒
- 支持iOS 13+设备
- 电池消耗优化

---

### 2.5 交易系统

#### 功能描述
玩家可以买卖领地、道具和资源，形成游戏内经济系统。

#### 功能需求
- **FR-TRADE-001**: 玩家可以发起领地出售
- **FR-TRADE-002**: 设置出售价格和交易条件
- **FR-TRADE-003**: 其他玩家可以浏览交易市场
- **FR-TRADE-004**: 支持一口价和竞价两种交易模式
- **FR-TRADE-005**: 交易完成后自动转移所有权
- **FR-TRADE-006**: 记录交易历史
- **FR-TRADE-007**: 支持道具和资源交易
- **FR-TRADE-008**: 平台收取一定比例手续费

#### 交互流程
1. 用户进入交易市场
2. 浏览在售领地/道具列表
3. 选择感兴趣的项目查看详情
4. 确认购买并支付
5. 完成交易，获得所有权
6. 收到交易确认通知

---

## 三、用户交互流程

### 3.1 新用户首次使用流程
```
启动App → 欢迎页 → 登录/注册 → 完善资料 →
新手引导（圈地教学） → 首次圈地 → 进入地图首页
```

### 3.2 老用户日常使用流程
```
启动App → 自动登录 → 地图首页 →
查看领地收益 → 探索新区域 → 圈地/交易 →
AR扫描收集资源 → 领地升级
```

---

## 四、技术需求

### 4.1 平台与开发环境
- **开发平台**: iOS
- **开发语言**: Swift
- **最低支持版本**: iOS 13.0+
- **开发工具**: Xcode

### 4.2 技术栈
- **前端框架**: SwiftUI
- **后端服务**: Supabase (云端数据库和认证)
- **地图服务**: 高德地图SDK / 百度地图SDK
- **AR框架**: ARKit
- **定位服务**: CoreLocation
- **版本控制**: Git + GitHub

### 4.3 数据存储
- **云端存储**: Supabase PostgreSQL
- **本地缓存**: UserDefaults / CoreData
- **静态资源**: CDN托管

---

## 五、非功能需求

### 5.1 性能需求
- App启动时间 < 3秒
- 页面切换响应时间 < 500ms
- 地图加载时间 < 3秒
- 网络请求超时时间: 10秒

### 5.2 安全需求
- 所有API通信使用HTTPS加密
- 用户Token采用JWT标准
- 敏感数据本地加密存储
- 防止SQL注入和XSS攻击

### 5.3 兼容性需求
- 支持iPhone 8及以上机型
- 适配iOS 13.0 - iOS 17.0
- 支持深色模式和浅色模式
- 支持横屏和竖屏切换

### 5.4 可用性需求
- 系统可用性达到99.5%
- 支持弱网环境下的降级使用
- 提供离线模式（查看已缓存的地图和领地）

---

## 六、运营需求

### 6.1 数据统计
- 用户注册数、活跃度、留存率
- 圈地数量、交易金额、AR扫描次数
- 崩溃率、错误日志

### 6.2 推送通知
- 领地被攻击提醒
- 交易成功通知
- 活动和奖励通知
- 系统维护通知

### 6.3 客服支持
- App内反馈入口
- 常见问题FAQ
- 在线客服通道

---

## 七、里程碑与优先级

### MVP版本（V1.0）- 核心功能
**优先级: P0**
- 用户登录与认证
- 基础圈地功能
- 地图首页展示
- 简单的交易系统

**预期交付时间**: 开发周期8周

### V1.1 版本 - 功能增强
**优先级: P1**
- AR扫描功能
- 领地升级系统
- 竞价交易模式
- 社交功能（好友、聊天）

**预期交付时间**: MVP发布后4周

### V2.0 版本 - 生态完善
**优先级: P2**
- 公会系统
- 领地战争
- 排行榜
- 成就系统

**预期交付时间**: V1.1发布后8周

---

## 八、风险与限制

### 8.1 技术风险
- GPS定位精度受环境影响
- AR功能在老旧设备上性能不足
- 高并发情况下服务器压力

### 8.2 业务风险
- 用户获取成本较高
- 竞品压力
- 政策监管风险（位置隐私）

### 8.3 缓解措施
- 提供定位校准功能
- 针对不同设备性能做优化
- 采用云服务商的弹性扩容方案
- 明确隐私政策，获得用户授权

---

## 九、附录

### 9.1 术语表
- **圈地**: 玩家在地图上占领一块区域的行为
- **领地**: 玩家占领的地理区域
- **AR扫描**: 通过增强现实技术扫描现实场景
- **Token**: 用户身份认证令牌

### 9.2 参考文档
- 游戏功能详解文档
- UI/UX设计稿
- 技术架构文档

---

**文档版本**: V1.0
**最后更新**: 2026-01-01
**文档所有者**: 产品团队
**审批状态**: 待审批
